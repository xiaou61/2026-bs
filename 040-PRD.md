# 040 - 社区车辆违停处理系统 PRD

## 项目概述

### 项目名称
基于SpringBoot的社区车辆违停处理系统的设计与实现

### 项目定位
智慧社区车辆管理系统，针对社区内车辆违规停放问题，提供举报、审核、处理、申诉的完整闭环管理，提升社区管理效率和居民满意度。

### 技术选型（多元化）
**后端：**
- Spring Boot 3.2.0
- **QueryDSL 5.0.0**（区别于已用的MyBatis/MyBatis-Plus/JPA/Spring Data JDBC/jOOQ，体现技术多样性）
- **JPA/Hibernate**（QueryDSL需要配合JPA使用）
- MySQL 8.0
- Redis 6.0+
- JWT 0.12.3
- Hutool工具库

**前端：**
- Vue 3.4.0
- Element Plus 2.5.1
- Vite 5.0
- Pinia 2.1.7
- Vue Router 4.2.5
- Axios 1.6.2
- 高德地图API（违停位置标注）

---

## 核心功能模块

### 1. 用户系统
**角色划分：**
- 普通居民：举报违停、查看自己的举报/被举报记录、申诉
- 物业管理员：审核举报、处理违停、查看统计数据
- 系统管理员：用户管理、车辆管理、公告管理、系统配置

**功能点：**
- 用户注册登录（手机号+密码）
- JWT Token认证
- 车辆绑定管理（车牌号、车辆类型、车辆照片）
- 个人信息管理（房号、联系方式）
- 角色权限控制

### 2. 违停举报
**举报流程：**
1. 居民发现违停 → 拍照上传（至少1张，最多3张）
2. 选择违停类型（占用消防通道/占用车位/占用盲道/堵塞出入口/其他）
3. 填写车牌号（可选，未识别时手动输入）
4. 选择违停位置（地图标注）
5. 填写违停描述
6. 提交举报

**功能点：**
- 多图上传（最多3张）
- 车牌号识别（OCR）或手动输入
- 违停类型分类
- 地图选点标注位置
- 举报时间自动记录
- 举报编号自动生成（格式：WP20260115001）
- 匿名举报选项

### 3. 举报审核
**审核流程：**
物业管理员 → 查看待审核举报 → 审核照片和信息 → 通过/驳回

**审核状态：**
- 待审核（pending）
- 审核通过（approved）
- 审核不通过（rejected）

**功能点：**
- 举报列表（按状态筛选）
- 举报详情查看（照片、车牌、位置、描述）
- 审核操作（通过/驳回）
- 驳回理由填写（必填）
- 批量审核

### 4. 违停处理
**处理流程：**
审核通过 → 物业管理员处理 → 联系车主 → 车主整改 → 处理完成

**处理状态：**
- 待处理（pending）
- 处理中（processing）
- 已整改（corrected）
- 未整改（uncorrected）

**功能点：**
- 待处理列表
- 联系车主（电话/短信通知）
- 现场处理记录（处理照片、处理说明）
- 处理结果记录
- 处理时间记录
- 超时未处理自动提醒

### 5. 申诉管理
**申诉流程：**
车主收到通知 → 提交申诉 → 上传证据 → 管理员审核申诉 → 申诉结果

**申诉理由：**
- 非本人车辆
- 停车时间短暂
- 紧急情况
- 其他原因

**功能点：**
- 申诉提交（文字描述+照片证据）
- 申诉列表（待审核/已通过/已驳回）
- 申诉审核（管理员）
- 申诉结果通知
- 申诉成功后撤销违停记录

### 6. 违停记录
**记录内容：**
- 违停信息（车牌、类型、位置、时间、照片）
- 举报人信息（可匿名）
- 审核信息（审核人、审核时间、审核结果）
- 处理信息（处理人、处理时间、处理结果）
- 申诉信息（如有）

**功能点：**
- 违停记录列表（按车辆/按时间/按类型查询）
- 违停记录详情
- 违停次数统计
- 导出Excel报表

### 7. 积分管理
**积分规则：**
- 举报违停且审核通过：+10积分
- 被举报违停且未申诉成功：-20积分
- 申诉成功：恢复扣除的积分
- 积分可兑换停车券或物业费抵扣

**功能点：**
- 积分余额查询
- 积分明细记录
- 积分排行榜
- 积分兑换（停车券/物业费抵扣）

### 8. 通知系统
**通知类型：**
- 举报提交成功通知
- 审核结果通知（通过/驳回）
- 违停处理通知（车主）
- 申诉结果通知
- 积分变动通知

**通知方式：**
- 站内消息
- 短信通知（模拟）
- 系统推送

### 9. 地图定位
**功能点：**
- 违停位置标注（举报时）
- 违停热力图（管理端）
- 社区地图展示
- 高德地图集成

### 10. 数据统计
**统计维度：**
- 违停类型分布（饼图）
- 违停时间段分布（柱状图）
- 违停热点区域（热力图）
- 处理效率统计（平均处理时长）
- 举报人排行榜
- 违停车辆排行榜

**功能点：**
- 数据看板（ECharts可视化）
- 日/周/月统计
- 导出统计报表

### 11. 车位管理
**功能点：**
- 车位信息管理（编号、类型、归属）
- 车位绑定（业主/车辆）
- 车位状态（空闲/占用）
- 车位使用记录

### 12. 系统公告
**功能点：**
- 公告发布（管理员）
- 公告列表
- 公告详情
- 公告置顶

### 13. 管理后台
**功能点：**
- 用户管理（列表、详情、启用/禁用）
- 车辆管理（列表、审核、删除）
- 举报管理（审核、处理）
- 申诉管理（审核）
- 违停记录管理
- 数据统计
- 系统配置

---

## 数据库设计

### 表结构（13张表）

1. **users** - 用户表
   - id, username, password, phone, real_name, room_number, role, status, points, created_at, updated_at

2. **vehicles** - 车辆表
   - id, user_id, plate_number, vehicle_type, vehicle_color, vehicle_photo, status, created_at, updated_at

3. **violation_types** - 违停类型表
   - id, name, description, penalty_points, created_at

4. **reports** - 举报表
   - id, report_no, reporter_id, vehicle_id, plate_number, violation_type_id, location, longitude, latitude, description, images, is_anonymous, status, audit_user_id, audit_time, audit_reason, created_at, updated_at

5. **report_handlers** - 处理记录表
   - id, report_id, handler_id, handler_name, contact_result, handle_description, handle_images, handle_status, handle_time, created_at, updated_at

6. **appeals** - 申诉表
   - id, report_id, user_id, appeal_reason, appeal_description, appeal_images, status, audit_user_id, audit_time, audit_result, created_at, updated_at

7. **parking_spaces** - 车位表
   - id, space_no, space_type, building, floor, owner_id, status, created_at, updated_at

8. **points_records** - 积分记录表
   - id, user_id, points, type, reason, related_id, created_at

9. **notifications** - 通知表
   - id, user_id, type, title, content, is_read, created_at

10. **announcements** - 公告表
    - id, title, content, author_id, is_top, views, created_at, updated_at

11. **point_exchanges** - 积分兑换表
    - id, user_id, points_cost, exchange_type, exchange_item, status, created_at

12. **system_config** - 系统配置表
    - id, config_key, config_value, description, created_at, updated_at

13. **operation_logs** - 操作日志表
    - id, user_id, operation, module, ip, created_at

---

## 技术亮点

### 1. QueryDSL技术
- 类型安全的查询构建
- 编译期检查，避免SQL错误
- 流畅的API，代码可读性高
- 复杂查询场景优势明显（多条件动态查询、统计分析）

### 2. 车牌识别
- 集成OCR识别库（模拟实现）
- 自动提取车牌号
- 识别失败时手动输入

### 3. 地图定位
- 高德地图API集成
- 违停位置标注
- 热力图展示

### 4. 积分激励
- 完整积分体系
- 举报奖励，违停惩罚
- 积分兑换实物

### 5. 申诉机制
- 公平的申诉流程
- 证据上传
- 申诉成功撤销记录

### 6. 数据可视化
- ECharts图表
- 实时数据统计
- 多维度分析

---

## 页面结构

### 用户端（11个页面）
1. 登录注册页
2. 首页（违停统计、快速举报）
3. 违停举报页（拍照、填信息、地图选点）
4. 我的举报列表
5. 我的违停记录
6. 违停详情页
7. 申诉提交页
8. 我的申诉列表
9. 积分中心（积分明细、兑换）
10. 个人中心（信息、车辆管理）
11. 公告列表

### 管理端（7个页面）
1. 管理员登录
2. 数据看板（统计图表）
3. 举报审核列表
4. 处理管理列表
5. 申诉审核列表
6. 用户管理
7. 系统配置

---

## 项目规模

- **数据库表**：13张表
- **后端接口**：70+个API
- **前端页面**：18个页面（用户端11+管理端7）
- **代码量**：约6500+行
- **功能模块**：13个核心模块

---

## 开发注意事项

1. **QueryDSL配置**：需要APT（Annotation Processing Tool）生成Q类
2. **地图API**：使用高德地图Web端JavaScript API
3. **图片上传**：支持多图上传，限制大小和格式
4. **积分系统**：事务保证一致性
5. **通知系统**：异步处理，避免阻塞主流程
6. **数据统计**：使用Redis缓存热点数据
7. **无注释代码**：遵循rule.md规则

---

## 演示流程

1. 居民注册登录 → 绑定车辆信息
2. 发现违停 → 拍照举报 → 填写信息 → 地图标注 → 提交
3. 物业管理员登录 → 审核举报 → 通过/驳回
4. 审核通过 → 分配处理 → 联系车主 → 现场处理
5. 车主收到通知 → 查看违停记录 → 提交申诉（如有异议）
6. 管理员审核申诉 → 通过/驳回
7. 处理完成 → 记录归档 → 积分变动
8. 查看数据统计 → 违停趋势、热点区域分析
9. 积分兑换 → 停车券或物业费抵扣

---

## 适合场景

- 智慧社区建设
- 物业管理系统
- 车辆管理平台
- 违停治理系统
- QueryDSL学习实践
- JPA高级应用
- 地图定位系统
- 积分激励系统设计

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>在线协作白板与笔记系统</title>
    
    <!-- Element Plus CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f7fa;
        }

        #app {
            height: 100vh;
            overflow: hidden;
        }

        /* 登录页面样式 */
        .login-container {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-box {
            width: 400px;
            padding: 40px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .login-title {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 30px;
        }

        /* 主布局 */
        .main-layout {
            display: flex;
            height: 100vh;
        }

        /* 侧边栏 */
        .sidebar {
            width: 240px;
            background: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 20px;
            font-size: 18px;
            font-weight: bold;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-menu {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .menu-item {
            padding: 12px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .menu-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .menu-item.active {
            background: rgba(255,255,255,0.15);
            border-left: 3px solid #409eff;
        }

        .sidebar-footer {
            padding: 15px 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        /* 主内容区 */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* 顶部导航 */
        .top-bar {
            height: 60px;
            background: white;
            border-bottom: 1px solid #e4e7ed;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }

        /* 内容区域 */
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        /* 文档列表 */
        .document-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
        }

        .document-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid #e4e7ed;
        }

        .document-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .document-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .document-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .document-meta {
            font-size: 12px;
            color: #909399;
        }

        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #909399;
        }

        .empty-icon {
            font-size: 60px;
            margin-bottom: 20px;
            color: #dcdfe6;
        }

        /* 编辑器容器 */
        .editor-container {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .editor-toolbar {
            height: 50px;
            background: white;
            border-bottom: 1px solid #e4e7ed;
            display: flex;
            align-items: center;
            padding: 0 15px;
            gap: 10px;
        }

        .editor-content {
            flex: 1;
            background: white;
            overflow: auto;
        }

        /* 白板画布 */
        .canvas-area {
            width: 100%;
            height: 100%;
            background: #f8f9fa;
            position: relative;
        }

        /* Markdown编辑器 */
        .markdown-editor {
            display: flex;
            height: 100%;
        }

        .markdown-input {
            flex: 1;
            border: none;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: none;
            outline: none;
        }

        .markdown-preview {
            flex: 1;
            border-left: 1px solid #e4e7ed;
            padding: 20px;
            overflow-y: auto;
        }

        /* 响应式 */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }

            .document-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <component :is="currentView"></component>
    </div>

    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Element Plus -->
    <script src="https://unpkg.com/element-plus"></script>
    
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <!-- Marked.js (Markdown解析) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script>
        const { createApp, ref, reactive, computed, onMounted, watch } = Vue;
        const { ElMessage, ElMessageBox, ElLoading } = ElementPlus;

        // API基础URL
        const API_BASE_URL = 'http://localhost:8012/api';

        // Axios配置
        axios.defaults.baseURL = API_BASE_URL;
        axios.interceptors.request.use(config => {
            const token = localStorage.getItem('token');
            if (token) {
                config.headers.Authorization = `Bearer ${token}`;
            }
            return config;
        });

        axios.interceptors.response.use(
            response => response.data,
            error => {
                if (error.response?.status === 401) {
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                    location.reload();
                }
                ElMessage.error(error.response?.data?.message || '请求失败');
                return Promise.reject(error);
            }
        );

        // 登录组件
        const LoginView = {
            template: `
                <div class="login-container">
                    <div class="login-box">
                        <div class="login-title">
                            <i class="fas fa-layer-group"></i>
                            协作白板系统
                        </div>
                        
                        <el-tabs v-model="activeTab">
                            <el-tab-pane label="登录" name="login">
                                <el-form :model="loginForm" @submit.prevent="handleLogin">
                                    <el-form-item>
                                        <el-input 
                                            v-model="loginForm.username" 
                                            placeholder="用户名"
                                            prefix-icon="User">
                                        </el-input>
                                    </el-form-item>
                                    <el-form-item>
                                        <el-input 
                                            v-model="loginForm.password" 
                                            type="password"
                                            placeholder="密码"
                                            prefix-icon="Lock"
                                            @keyup.enter="handleLogin">
                                        </el-input>
                                    </el-form-item>
                                    <el-form-item>
                                        <el-button 
                                            type="primary" 
                                            style="width: 100%"
                                            @click="handleLogin"
                                            :loading="loading">
                                            登录
                                        </el-button>
                                    </el-form-item>
                                </el-form>
                            </el-tab-pane>
                            
                            <el-tab-pane label="注册" name="register">
                                <el-form :model="registerForm" @submit.prevent="handleRegister">
                                    <el-form-item>
                                        <el-input 
                                            v-model="registerForm.username" 
                                            placeholder="用户名"
                                            prefix-icon="User">
                                        </el-input>
                                    </el-form-item>
                                    <el-form-item>
                                        <el-input 
                                            v-model="registerForm.nickname" 
                                            placeholder="昵称"
                                            prefix-icon="UserFilled">
                                        </el-input>
                                    </el-form-item>
                                    <el-form-item>
                                        <el-input 
                                            v-model="registerForm.email" 
                                            placeholder="邮箱"
                                            prefix-icon="Message">
                                        </el-input>
                                    </el-form-item>
                                    <el-form-item>
                                        <el-input 
                                            v-model="registerForm.password" 
                                            type="password"
                                            placeholder="密码"
                                            prefix-icon="Lock">
                                        </el-input>
                                    </el-form-item>
                                    <el-form-item>
                                        <el-button 
                                            type="primary" 
                                            style="width: 100%"
                                            @click="handleRegister"
                                            :loading="loading">
                                            注册
                                        </el-button>
                                    </el-form-item>
                                </el-form>
                            </el-tab-pane>
                        </el-tabs>
                    </div>
                </div>
            `,
            setup(props, { emit }) {
                const activeTab = ref('login');
                const loading = ref(false);
                const loginForm = reactive({
                    username: '',
                    password: ''
                });
                const registerForm = reactive({
                    username: '',
                    nickname: '',
                    email: '',
                    password: ''
                });

                const handleLogin = async () => {
                    if (!loginForm.username || !loginForm.password) {
                        ElMessage.warning('请输入用户名和密码');
                        return;
                    }

                    loading.value = true;
                    try {
                        const res = await axios.post('/auth/login', loginForm);
                        localStorage.setItem('token', res.data.token);
                        localStorage.setItem('user', JSON.stringify(res.data.user));
                        ElMessage.success('登录成功');
                        emit('login-success');
                    } catch (error) {
                        console.error(error);
                    } finally {
                        loading.value = false;
                    }
                };

                const handleRegister = async () => {
                    if (!registerForm.username || !registerForm.password || !registerForm.nickname) {
                        ElMessage.warning('请填写完整信息');
                        return;
                    }

                    loading.value = true;
                    try {
                        const res = await axios.post('/auth/register', registerForm);
                        localStorage.setItem('token', res.data.token);
                        localStorage.setItem('user', JSON.stringify(res.data.user));
                        ElMessage.success('注册成功');
                        emit('login-success');
                    } catch (error) {
                        console.error(error);
                    } finally {
                        loading.value = false;
                    }
                };

                return {
                    activeTab,
                    loading,
                    loginForm,
                    registerForm,
                    handleLogin,
                    handleRegister
                };
            }
        };

        // 主应用组件
        const MainView = {
            template: `
                <div class="main-layout">
                    <!-- 侧边栏 -->
                    <div class="sidebar">
                        <div class="sidebar-header">
                            <i class="fas fa-layer-group"></i> 协作白板
                        </div>
                        
                        <div class="sidebar-menu">
                            <div 
                                v-for="item in menuItems" 
                                :key="item.name"
                                class="menu-item"
                                :class="{ active: currentPage === item.name }"
                                @click="currentPage = item.name">
                                <i :class="item.icon"></i>
                                <span>{{ item.label }}</span>
                            </div>
                        </div>
                        
                        <div class="sidebar-footer">
                            <div style="margin-bottom: 10px;">
                                <i class="fas fa-user"></i>
                                {{ user.nickname }}
                            </div>
                            <el-button size="small" @click="handleLogout" style="width: 100%">
                                退出登录
                            </el-button>
                        </div>
                    </div>
                    
                    <!-- 主内容区 -->
                    <div class="main-content">
                        <div class="top-bar">
                            <div>
                                <h3>{{ currentPageTitle }}</h3>
                            </div>
                            <div>
                                <el-button 
                                    v-if="currentPage === 'documents'" 
                                    type="primary" 
                                    @click="showCreateDialog = true">
                                    <i class="fas fa-plus"></i> 新建文档
                                </el-button>
                            </div>
                        </div>
                        
                        <div class="content-area">
                            <!-- 文档列表页 -->
                            <div v-if="currentPage === 'documents'">
                                <div v-if="documents.length > 0" class="document-grid">
                                    <div 
                                        v-for="doc in documents" 
                                        :key="doc.id"
                                        class="document-card"
                                        @click="openDocument(doc)">
                                        <div class="document-icon" :style="{ color: getDocTypeColor(doc.docType) }">
                                            <i :class="getDocTypeIcon(doc.docType)"></i>
                                        </div>
                                        <div class="document-title">{{ doc.title }}</div>
                                        <div class="document-meta">
                                            {{ formatDate(doc.updateTime) }}
                                        </div>
                                    </div>
                                </div>
                                <div v-else class="empty-state">
                                    <div class="empty-icon">
                                        <i class="fas fa-folder-open"></i>
                                    </div>
                                    <div>暂无文档，点击右上角创建</div>
                                </div>
                            </div>
                            
                            <!-- 团队页面 -->
                            <div v-else-if="currentPage === 'teams'">
                                <el-button type="primary" @click="showTeamDialog = true" style="margin-bottom: 20px">
                                    <i class="fas fa-plus"></i> 创建团队
                                </el-button>
                                
                                <div v-if="teams.length > 0" style="display: grid; gap: 15px;">
                                    <el-card v-for="team in teams" :key="team.id">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <h3>{{ team.teamName }}</h3>
                                                <p style="color: #909399; margin-top: 5px;">{{ team.description }}</p>
                                                <div style="margin-top: 10px; font-size: 14px; color: #606266;">
                                                    <i class="fas fa-users"></i> {{ team.memberCount }} 成员
                                                    <span style="margin-left: 15px;">
                                                        <i class="fas fa-file"></i> {{ team.docCount }} 文档
                                                    </span>
                                                </div>
                                            </div>
                                            <el-button @click="viewTeam(team)">查看详情</el-button>
                                        </div>
                                    </el-card>
                                </div>
                                <div v-else class="empty-state">
                                    <div class="empty-icon"><i class="fas fa-users"></i></div>
                                    <div>暂无团队</div>
                                </div>
                            </div>
                            
                            <!-- 模板市场 -->
                            <div v-else-if="currentPage === 'templates'">
                                <div v-if="templates.length > 0" class="document-grid">
                                    <div 
                                        v-for="tpl in templates" 
                                        :key="tpl.id"
                                        class="document-card"
                                        @click="useTemplate(tpl)">
                                        <div class="document-icon" :style="{ color: getDocTypeColor(tpl.templateType) }">
                                            <i :class="getDocTypeIcon(tpl.templateType)"></i>
                                        </div>
                                        <div class="document-title">{{ tpl.templateName }}</div>
                                        <div class="document-meta">
                                            使用次数: {{ tpl.useCount }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 个人中心 -->
                            <div v-else-if="currentPage === 'profile'">
                                <el-card>
                                    <h3 style="margin-bottom: 20px">个人信息</h3>
                                    <el-form :model="user" label-width="80px">
                                        <el-form-item label="用户名">
                                            <el-input v-model="user.username" disabled></el-input>
                                        </el-form-item>
                                        <el-form-item label="昵称">
                                            <el-input v-model="user.nickname"></el-input>
                                        </el-form-item>
                                        <el-form-item label="邮箱">
                                            <el-input v-model="user.email"></el-input>
                                        </el-form-item>
                                        <el-form-item label="签名">
                                            <el-input v-model="user.signature" type="textarea"></el-input>
                                        </el-form-item>
                                        <el-form-item>
                                            <el-button type="primary" @click="updateProfile">保存</el-button>
                                        </el-form-item>
                                    </el-form>
                                </el-card>
                                
                                <el-card style="margin-top: 20px">
                                    <h3 style="margin-bottom: 20px">统计信息</h3>
                                    <el-row :gutter="20">
                                        <el-col :span="8">
                                            <el-statistic title="文档数" :value="user.docCount"></el-statistic>
                                        </el-col>
                                        <el-col :span="8">
                                            <el-statistic title="协作次数" :value="user.collabCount"></el-statistic>
                                        </el-col>
                                        <el-col :span="8">
                                            <el-statistic title="团队数" :value="user.teamCount"></el-statistic>
                                        </el-col>
                                    </el-row>
                                </el-card>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 创建文档对话框 -->
                <el-dialog v-model="showCreateDialog" title="新建文档" width="500px">
                    <el-form :model="createForm" label-width="80px">
                        <el-form-item label="文档标题">
                            <el-input v-model="createForm.title" placeholder="请输入文档标题"></el-input>
                        </el-form-item>
                        <el-form-item label="文档类型">
                            <el-radio-group v-model="createForm.docType">
                                <el-radio label="BOARD">白板</el-radio>
                                <el-radio label="MINDMAP">思维导图</el-radio>
                                <el-radio label="NOTE">笔记</el-radio>
                            </el-radio-group>
                        </el-form-item>
                    </el-form>
                    <template #footer>
                        <el-button @click="showCreateDialog = false">取消</el-button>
                        <el-button type="primary" @click="createDocument">创建</el-button>
                    </template>
                </el-dialog>
                
                <!-- 创建团队对话框 -->
                <el-dialog v-model="showTeamDialog" title="创建团队" width="500px">
                    <el-form :model="teamForm" label-width="80px">
                        <el-form-item label="团队名称">
                            <el-input v-model="teamForm.teamName" placeholder="请输入团队名称"></el-input>
                        </el-form-item>
                        <el-form-item label="团队描述">
                            <el-input v-model="teamForm.description" type="textarea" placeholder="请输入团队描述"></el-input>
                        </el-form-item>
                    </el-form>
                    <template #footer>
                        <el-button @click="showTeamDialog = false">取消</el-button>
                        <el-button type="primary" @click="createTeam">创建</el-button>
                    </template>
                </el-dialog>
                
                <!-- 文档编辑器 -->
                <el-drawer 
                    v-model="showEditor" 
                    :title="currentDoc?.title"
                    size="100%"
                    direction="rtl">
                    <div class="editor-container" v-if="currentDoc">
                        <div class="editor-toolbar">
                            <el-button size="small" @click="saveDocument">
                                <i class="fas fa-save"></i> 保存
                            </el-button>
                            <el-button size="small" @click="showEditor = false">
                                <i class="fas fa-times"></i> 关闭
                            </el-button>
                        </div>
                        
                        <div class="editor-content">
                            <!-- 白板编辑器 -->
                            <div v-if="currentDoc.docType === 'BOARD'" class="canvas-area">
                                <canvas id="boardCanvas"></canvas>
                                <div style="padding: 20px; text-align: center; color: #909399;">
                                    <i class="fas fa-pencil-ruler" style="font-size: 48px; margin-bottom: 10px;"></i>
                                    <p>白板编辑器（演示）</p>
                                    <p style="font-size: 12px; margin-top: 10px;">实际项目中需要集成 Fabric.js 或 Konva.js</p>
                                </div>
                            </div>
                            
                            <!-- 思维导图编辑器 -->
                            <div v-else-if="currentDoc.docType === 'MINDMAP'" class="canvas-area">
                                <div style="padding: 20px; text-align: center; color: #909399;">
                                    <i class="fas fa-project-diagram" style="font-size: 48px; margin-bottom: 10px;"></i>
                                    <p>思维导图编辑器（演示）</p>
                                    <p style="font-size: 12px; margin-top: 10px;">实际项目中需要集成思维导图库</p>
                                </div>
                            </div>
                            
                            <!-- Markdown编辑器 -->
                            <div v-else class="markdown-editor">
                                <textarea 
                                    v-model="editorContent"
                                    class="markdown-input"
                                    placeholder="在此输入Markdown内容...">
                                </textarea>
                                <div class="markdown-preview" v-html="markdownHtml"></div>
                            </div>
                        </div>
                    </div>
                </el-drawer>
            `,
            setup(props, { emit }) {
                const user = ref(JSON.parse(localStorage.getItem('user') || '{}'));
                const currentPage = ref('documents');
                const documents = ref([]);
                const teams = ref([]);
                const templates = ref([]);
                const showCreateDialog = ref(false);
                const showTeamDialog = ref(false);
                const showEditor = ref(false);
                const currentDoc = ref(null);
                const editorContent = ref('');

                const menuItems = [
                    { name: 'documents', label: '我的文档', icon: 'fas fa-folder' },
                    { name: 'teams', label: '团队空间', icon: 'fas fa-users' },
                    { name: 'templates', label: '模板市场', icon: 'fas fa-th-large' },
                    { name: 'profile', label: '个人中心', icon: 'fas fa-user-circle' }
                ];

                const createForm = reactive({
                    title: '',
                    docType: 'NOTE'
                });

                const teamForm = reactive({
                    teamName: '',
                    description: ''
                });

                const currentPageTitle = computed(() => {
                    const item = menuItems.find(m => m.name === currentPage.value);
                    return item ? item.label : '';
                });

                const markdownHtml = computed(() => {
                    if (typeof marked !== 'undefined') {
                        return marked.parse(editorContent.value);
                    }
                    return editorContent.value;
                });

                const loadDocuments = async () => {
                    try {
                        const res = await axios.get('/document/list');
                        documents.value = res.data.records || [];
                    } catch (error) {
                        console.error(error);
                    }
                };

                const loadTeams = async () => {
                    try {
                        const res = await axios.get('/team/list');
                        teams.value = res.data || [];
                    } catch (error) {
                        console.error(error);
                    }
                };

                const loadTemplates = async () => {
                    try {
                        const res = await axios.get('/template/list', {
                            params: { isPublic: 1 }
                        });
                        templates.value = res.data.records || [];
                    } catch (error) {
                        console.error(error);
                    }
                };

                const createDocument = async () => {
                    if (!createForm.title) {
                        ElMessage.warning('请输入文档标题');
                        return;
                    }

                    try {
                        const res = await axios.post('/document/create', createForm);
                        ElMessage.success('创建成功');
                        showCreateDialog.value = false;
                        createForm.title = '';
                        createForm.docType = 'NOTE';
                        loadDocuments();
                    } catch (error) {
                        console.error(error);
                    }
                };

                const createTeam = async () => {
                    if (!teamForm.teamName) {
                        ElMessage.warning('请输入团队名称');
                        return;
                    }

                    try {
                        await axios.post('/team/create', teamForm);
                        ElMessage.success('创建成功');
                        showTeamDialog.value = false;
                        teamForm.teamName = '';
                        teamForm.description = '';
                        loadTeams();
                    } catch (error) {
                        console.error(error);
                    }
                };

                const openDocument = async (doc) => {
                    try {
                        const res = await axios.get(`/document/${doc.id}`);
                        currentDoc.value = res.data;
                        editorContent.value = res.data.content || '';
                        showEditor.value = true;
                    } catch (error) {
                        console.error(error);
                    }
                };

                const saveDocument = async () => {
                    if (!currentDoc.value) return;

                    try {
                        await axios.put(`/document/${currentDoc.value.id}`, {
                            content: editorContent.value
                        });
                        ElMessage.success('保存成功');
                    } catch (error) {
                        console.error(error);
                    }
                };

                const useTemplate = async (template) => {
                    try {
                        await axios.post(`/template/${template.id}/use`);
                        
                        const res = await axios.post('/document/create', {
                            title: template.templateName + ' - 副本',
                            docType: template.templateType
                        });
                        
                        ElMessage.success('已基于模板创建文档');
                        currentPage.value = 'documents';
                        loadDocuments();
                    } catch (error) {
                        console.error(error);
                    }
                };

                const updateProfile = async () => {
                    try {
                        await axios.put('/user/profile', {
                            nickname: user.value.nickname,
                            email: user.value.email,
                            signature: user.value.signature
                        });
                        localStorage.setItem('user', JSON.stringify(user.value));
                        ElMessage.success('更新成功');
                    } catch (error) {
                        console.error(error);
                    }
                };

                const handleLogout = () => {
                    ElMessageBox.confirm('确定要退出登录吗？', '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(() => {
                        localStorage.removeItem('token');
                        localStorage.removeItem('user');
                        emit('logout');
                    }).catch(() => {});
                };

                const getDocTypeIcon = (type) => {
                    const icons = {
                        'BOARD': 'fas fa-chalkboard',
                        'MINDMAP': 'fas fa-project-diagram',
                        'NOTE': 'fas fa-file-alt'
                    };
                    return icons[type] || 'fas fa-file';
                };

                const getDocTypeColor = (type) => {
                    const colors = {
                        'BOARD': '#409eff',
                        'MINDMAP': '#67c23a',
                        'NOTE': '#e6a23c'
                    };
                    return colors[type] || '#909399';
                };

                const formatDate = (dateStr) => {
                    if (!dateStr) return '';
                    const date = new Date(dateStr);
                    return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
                };

                const viewTeam = (team) => {
                    ElMessage.info('团队详情功能待开发');
                };

                watch(currentPage, (newVal) => {
                    if (newVal === 'documents') loadDocuments();
                    else if (newVal === 'teams') loadTeams();
                    else if (newVal === 'templates') loadTemplates();
                });

                onMounted(() => {
                    loadDocuments();
                });

                return {
                    user,
                    currentPage,
                    menuItems,
                    documents,
                    teams,
                    templates,
                    showCreateDialog,
                    showTeamDialog,
                    showEditor,
                    currentDoc,
                    editorContent,
                    createForm,
                    teamForm,
                    currentPageTitle,
                    markdownHtml,
                    createDocument,
                    createTeam,
                    openDocument,
                    saveDocument,
                    useTemplate,
                    updateProfile,
                    handleLogout,
                    getDocTypeIcon,
                    getDocTypeColor,
                    formatDate,
                    viewTeam
                };
            }
        };

        // 主应用
        createApp({
            components: {
                LoginView,
                MainView
            },
            setup() {
                const currentView = ref('LoginView');

                onMounted(() => {
                    const token = localStorage.getItem('token');
                    if (token) {
                        currentView.value = 'MainView';
                    }
                });

                const handleLoginSuccess = () => {
                    currentView.value = 'MainView';
                };

                const handleLogout = () => {
                    currentView.value = 'LoginView';
                };

                return {
                    currentView,
                    handleLoginSuccess,
                    handleLogout
                };
            },
            template: `
                <component 
                    :is="currentView" 
                    @login-success="handleLoginSuccess"
                    @logout="handleLogout">
                </component>
            `
        })
        .use(ElementPlus)
        .mount('#app');
    </script>
</body>
</html>

